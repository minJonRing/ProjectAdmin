var se=Object.defineProperty,re=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var $=(d,l,i)=>l in d?se(d,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[l]=i,S=(d,l)=>{for(var i in l||(l={}))ie.call(l,i)&&$(d,i,l[i]);if(Y)for(var i of Y(l))ce.call(l,i)&&$(d,i,l[i]);return d},L=(d,l)=>re(d,de(l));import{_ as Z,g as ee,s as _e,u as me}from"./index.85ad4f27.js";import{u as J}from"./detail.31e6a3a5.js";import{g as a,o as v,k as U,i as o,j as b,t as D,F as G,l as H,w as n,n as p,f as A,Z as ue,I as k,M as K,O as B,q as oe,_ as pe,G as fe,H as he,W as le,a as ne,E as ve}from"./vendor.8c10c2f2.js";import{r as W,b as M,c as ge}from"./rules.a17129b4.js";import{u as be}from"./search.51f3b729.js";import{U as ye}from"./index.fc0fd315.js";const Ce={name:"info",props:{form:W.Object},components:{},setup(d){const{form:l}=d;return{form:l}}},ke={class:"project-left"},Ve={class:"name"},Ie={class:"time"},we={class:"item"},xe={class:"personnel-name"};function Se(d,l,i,e,z,T){const s=a("el-image"),r=a("el-divider"),_=a("el-tag"),u=a("el-card");return v(),U("div",ke,[o(s,{class:"avatar",src:e.form.avatar.length?e.form.avatar[0].filePath:"",fit:"cover"},null,8,["src"]),b("div",Ve,D(e.form.name),1),b("div",Ie,"\u9879\u76EE\u65F6\u95F4\uFF1A"+D(e.form.developTime.join(" \u81F3 ")),1),o(r),(v(!0),U(G,null,H(e.form.personnel,(c,f)=>(v(),U("div",{key:f,class:"personnel"},[o(_,{type:c.type},{default:n(()=>[p(D(c.label),1)]),_:2},1032,["type"]),b("div",we,[(v(!0),U(G,null,H(c.children,(w,x)=>(v(),A(u,{key:x,shadow:"always","body-style":{padding:"0"}},{default:n(()=>[o(s,{style:{width:"60px",height:"60px"},src:w.avatar||"",fit:"cover"},null,8,["src"]),b("div",xe,D(w.name),1)]),_:2},1024))),128))])]))),128))])}var je=Z(Ce,[["render",Se],["__scopeId","data-v-3aeca0e5"]]);const Ue={name:"info",props:{questionIds:W.Object},components:{Upload:ue,UploadFile:ye},setup(d){const{questionIds:{itemId:l,projectId:i}}=d,e=k(!1),{handleDetail:z,submit:T}=J("/project/question/path"),{search:s,handleSearch:r,handleReset:_,table:u,pagination:c,handleCurrentChange:f,handleSizeChange:w,handleDelete:x}=be({url:"/project/question/path",searchParam:{projectId:i,name:"",status:""}});console.log(u);const q=k(null),V=k({itemId:l,projectId:i,name:"",describe:"",treat:"",fileList:[],status:0}),t=k({name:M,describe:M,treat:M}),E=m=>{V.value=m,e.value=!0},O=()=>{q.value.validate((m,R)=>{if(m){const I=["propose","solve","confirm"][V.value.status],N=L(S({},V.value),{[I]:"629068c83f517a3de6d77310"});T(N).then(()=>{V.value={itemId:l,projectId:i,name:"",describe:"",treat:"",fileList:[],status:0},r()})}else console.log("\u8868\u5355\u9A8C\u8BC1\u5931\u8D25!",R)})};return K(()=>{}),{search:s,handleSearch:r,handleReset:_,table:u,pagination:c,handleCurrentChange:f,handleSizeChange:w,handleDelete:x,handleSee:E,addScreen:e,formRef:q,form:V,rules:t,handleSubmit:O}}},qe=d=>(fe("data-v-ea1f719c"),d=d(),he(),d),Re=p("\u67E5\u8BE2"),Le=p("\u91CD\u7F6E"),De=p("\u67E5\u770B"),ze={style:{padding:"18px 0"}},Te={class:"right"},Qe={key:0,class:"handle-add"},Be=qe(()=>b("div",null,"\u65B0\u589E\u95EE\u9898",-1)),Ee=p("\u53D6\u6D88"),Fe=p("\u786E\u8BA4");function Ne(d,l,i,e,z,T){const s=a("el-input"),r=a("el-form-item"),_=a("el-button"),u=a("el-form"),c=a("el-table-column"),f=a("el-table"),w=a("el-pagination"),x=a("Upload"),q=a("el-icon"),V=a("UploadFile");return v(),U("div",{class:pe(["question",e.addScreen?"add":""])},[b("div",{class:"left",onClick:l[2]||(l[2]=B(t=>e.addScreen=!1,["stop"]))},[o(u,{class:"search",model:e.search,inline:""},{default:n(()=>[o(r,{label:"\u540D\u79F0"},{default:n(()=>[o(s,{modelValue:e.search.name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.search.name=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1}),o(r,{label:"\u72B6\u6001"},{default:n(()=>[o(s,{modelValue:e.search.name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.search.name=t),clearable:"",placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue"])]),_:1}),o(r,null,{default:n(()=>[o(_,{type:"primary",onClick:e.handleSearch},{default:n(()=>[Re]),_:1},8,["onClick"]),o(_,{onClick:e.handleReset},{default:n(()=>[Le]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),o(f,{data:e.table,border:"",stripe:""},{default:n(()=>[o(c,{type:"index",width:"50"}),o(c,{prop:"name",label:"\u540D\u79F0"}),o(c,{prop:"status",label:"\u72B6\u6001",width:"80"},{default:n(({row:{status:t}})=>[p(D(["\u5F85\u4FEE\u6539","\u5F85\u786E\u8BA4","\u4FEE\u6539\u5B8C\u6210"][t]),1)]),_:1}),o(c,{prop:"propose",label:"\u63D0\u51FA\u4EBA"},{default:n(({row:{propose:t}})=>[p(D(t?t.name:""),1)]),_:1}),o(c,{prop:"solve",label:"\u4FEE\u6539\u4EBA"},{default:n(({row:{solve:t}})=>[p(D(t?t.name:""),1)]),_:1}),o(c,{prop:"confirm",label:"\u786E\u8BA4\u4EBA"},{default:n(({row:{confirm:t}})=>[p(D(t?t.name:""),1)]),_:1}),o(c,{label:"\u64CD\u4F5C"},{default:n(({row:t})=>[o(_,{type:"text",onClick:B(E=>e.handleSee(t),["stop"])},{default:n(()=>[De]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),b("div",ze,[o(w,{small:"",background:"",layout:"total, sizes, prev, pager, next, jumper",currentPage:e.pagination.currentPage,"page-size":e.pagination.pageSize,total:e.pagination.pageTotal,onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["currentPage","page-size","total","onSizeChange","onCurrentChange"])])]),b("div",Te,[e.addScreen?(v(),A(u,{key:1,model:e.form,ref:"formRef",rules:e.rules,inline:!1,"label-width":"70px"},{default:n(()=>[o(r,{label:"\u540D\u79F0",prop:"name"},{default:n(()=>[o(s,{modelValue:e.form.name,"onUpdate:modelValue":l[4]||(l[4]=t=>e.form.name=t),placeholder:"\u8BF7\u8F93\u5165",clearable:""},null,8,["modelValue"])]),_:1}),o(r,{label:"\u63CF\u8FF0",prop:"describe"},{default:n(()=>[o(s,{rows:2,type:"textarea",modelValue:e.form.describe,"onUpdate:modelValue":l[5]||(l[5]=t=>e.form.describe=t),placeholder:"\u8BF7\u8F93\u5165",clearable:""},null,8,["modelValue"])]),_:1}),o(r,{label:"\u9644\u4EF6",prop:"fileList"},{default:n(()=>[o(V,{modelValue:e.form.fileList,"onUpdate:modelValue":l[6]||(l[6]=t=>e.form.fileList=t),url:"/upload/img"},null,8,["modelValue"])]),_:1}),e.form.status==1?(v(),A(r,{key:0,label:"\u5904\u7406\u65B9\u6CD5",prop:"treat"},{default:n(()=>[o(s,{rows:2,type:"textarea",modelValue:e.form.treat,"onUpdate:modelValue":l[7]||(l[7]=t=>e.form.treat=t),placeholder:"\u8BF7\u8F93\u5165",clearable:""},null,8,["modelValue"])]),_:1})):oe("",!0),o(r,null,{default:n(()=>[o(_,{onClick:l[8]||(l[8]=B(t=>e.addScreen=!1,["stop"]))},{default:n(()=>[Ee]),_:1}),o(_,{type:"primary",onClick:e.handleSubmit},{default:n(()=>[Fe]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])):(v(),U("div",Qe,[o(_,{plain:"",onClick:l[3]||(l[3]=B(t=>e.addScreen=!0,["stop"]))},{default:n(()=>[o(q,null,{default:n(()=>[o(x)]),_:1}),Be]),_:1})]))])],2)}var Pe=Z(Ue,[["render",Ne],["__scopeId","data-v-ea1f719c"]]);const Ae={name:"info",props:{db:W.Object,read:W.Boolean},components:{Question:Pe},setup(d){const{db:l}=d,{personnelList:i,personnel:e}=l,{handleDetail:z,submit:T}=J("/project/item"),s=le();ne();const{id:r}=s.query,_=k([{label:1}]),u=k(null),c=k(!1),f=k({projectId:r,parentId:0,name:"",personnel:[]}),w=k({name:M,personnel:ge}),x=()=>{f.value=L(S({},f.value),{parentId:0,name:"",personnel:[]}),c.value=!0},q=()=>{z(r).then(g=>{const{list:h}=g;_.value=R(h,{id:"id",parent:"parentId",name:"name",root:0})})},V=()=>{q()},t=g=>{console.log(g),f.value=L(S({},f.value),{parentId:g.id,name:"",personnel:[]}),c.value=!0},E=g=>{f.value=L(S({},g),{personnel:g.personnel.map(({_id:h})=>h)}),c.value=!0},O=g=>{const{id:h}=g;ee.loading=!0,_e({url:`/project/item/${h}`,method:"delete"}).then(()=>{ve.success("\u5220\u9664\u6210\u529F")}).finally(()=>{ee.loading=!1})},m=()=>{u.value.validate((g,h)=>{g?T(S({},f.value)).then(P=>{c.value=!1}):(console.log("\u8868\u5355\u9A8C\u8BC1\u5931\u8D25!",h),j("\u8868\u5355\u9A8C\u8BC1\u5931\u8D25!"))})},R=(g,h)=>{let P=[],y=g;for(let C=0;C<y.length;C++)if(y[C][h.parent]===h.root){let F=L(S({},y[C]),{id:y[C][h.id],label:y[C][h.name],children:[]});P.push(F),y.splice(C,1),C--}var X=function(C){if(y.length>0)for(let F=0;F<C.length;F++){for(let Q=0;Q<y.length;Q++)if(C[F].id===y[Q][h.parent]){let ae=L(S({},y[Q]),{id:y[Q][h.id],label:y[Q][h.name],children:[]});C[F].children.push(ae),y.splice(Q,1),Q--}X(C[F].children)}};return X(P),P},I=k(!1),N=k({itemId:"",projectId:""}),te=g=>{const{id:h,projectId:P}=g;N.value={itemId:h,projectId:P},I.value=!0};return K(()=>{r&&q()}),{personnelList:i,personnel:e,show:c,handleShow:x,tree:_,form:f,rules:w,itemRef:u,handleRe:V,handleItemAdd:m,handleItemReAdd:t,handleItemEdit:E,handleItemDelete:O,question:I,handleAddQuestion:te,questionIds:N}}},Oe={class:"project-right"},Me=p("\u6DFB\u52A0\u76EE\u5F55"),Ge=p("\u5237\u65B0"),He={class:"custom-tree-node"},We={class:"tree-info"},Ze={class:"personnel-list"},Je=p(" \u95EE\u9898\uFF1A22/31 "),Ke=p(" \u6DFB\u52A0 "),Xe=p(" \u7F16\u8F91 "),Ye=p(" \u5220\u9664 "),$e={class:"dialog-footer"},eo=p("\u53D6\u6D88"),oo=p("\u786E\u8BA4");function lo(d,l,i,e,z,T){const s=a("el-button"),r=a("el-image"),_=a("el-tooltip"),u=a("el-card"),c=a("el-popconfirm"),f=a("el-tree"),w=a("el-input"),x=a("el-form-item"),q=a("el-option"),V=a("el-select"),t=a("el-form"),E=a("el-dialog"),O=a("Question");return v(),U("div",Oe,[b("div",null,[o(s,{type:"primary",onClick:e.handleShow},{default:n(()=>[Me]),_:1},8,["onClick"]),o(s,{onClick:e.handleRe},{default:n(()=>[Ge]),_:1},8,["onClick"])]),o(f,{data:e.tree},{default:n(({node:m,data:R})=>[b("span",He,[b("div",We,[b("span",null,D(m.label),1)]),b("div",{class:"tree-edit",onClick:l[0]||(l[0]=B(()=>{},["stop"]))},[b("div",Ze,[(v(!0),U(G,null,H(R.personnel,(I,N)=>(v(),A(u,{key:N,shadow:"always","body-style":{padding:"0"}},{default:n(()=>[o(_,{class:"box-item",content:I.name,placement:"top-start",effect:"light"},{default:n(()=>[o(r,{style:{width:"20px",height:"20px"},src:I.avatar||"",fit:"cover"},null,8,["src"])]),_:2},1032,["content"])]),_:2},1024))),128))]),o(s,{type:"primary",plain:"",onClick:B(I=>e.handleAddQuestion(R),["stop"])},{default:n(()=>[Je]),_:2},1032,["onClick"]),o(s,{type:"primary",onClick:B(I=>e.handleItemReAdd(R),["stop"])},{default:n(()=>[Ke]),_:2},1032,["onClick"]),o(s,{onClick:B(I=>e.handleItemEdit(R),["stop"])},{default:n(()=>[Xe]),_:2},1032,["onClick"]),o(c,{title:"Are you sure to delete this?",onConfirm:I=>e.handleItemDelete(R)},{reference:n(()=>[o(s,{type:"danger"},{default:n(()=>[Ye]),_:1})]),_:2},1032,["onConfirm"])])])]),_:1},8,["data"]),o(E,{modelValue:e.show,"onUpdate:modelValue":l[4]||(l[4]=m=>e.show=m),title:"\u76EE\u5F55",width:"400px"},{footer:n(()=>[b("span",$e,[o(s,{onClick:l[3]||(l[3]=m=>e.show=!1)},{default:n(()=>[eo]),_:1}),o(s,{type:"primary",onClick:e.handleItemAdd},{default:n(()=>[oo]),_:1},8,["onClick"])])]),default:n(()=>[o(t,{model:e.form,ref:"itemRef",rules:e.rules},{default:n(()=>[o(x,{label:"\u76EE\u5F55\u540D\u79F0",prop:"name"},{default:n(()=>[o(w,{modelValue:e.form.name,"onUpdate:modelValue":l[1]||(l[1]=m=>e.form.name=m),placeholder:"\u8BF7\u8F93\u5165",clearable:""},null,8,["modelValue"])]),_:1}),o(x,{label:"\u8D1F\u8D23\u4EBA\u5458"},{default:n(()=>[o(V,{modelValue:e.form.personnel,"onUpdate:modelValue":l[2]||(l[2]=m=>e.form.personnel=m),placeholder:"\u8BF7\u9009\u62E9",clearable:"",filterable:"",multiple:""},{default:n(()=>[(v(!0),U(G,null,H(e.personnelList,m=>(v(),A(q,{key:m._id,label:m.name,value:m._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o(E,{title:"\u95EE\u9898",modelValue:e.question,"onUpdate:modelValue":l[5]||(l[5]=m=>e.question=m),width:"1200px"},{default:n(()=>[o(O,{questionIds:e.questionIds},null,8,["questionIds"])]),_:1},8,["modelValue"])])}var no=Z(Ae,[["render",lo],["__scopeId","data-v-62cd2f3a"]]);const to={name:"info",components:{Left:je,Right:no},setup(d){const l=k(!1);let i=k({name:"",developTime:[],avatar:[],fileList:[],personnel:[]});const e=le();ne();const{handleDetail:z,submit:T}=J("/project");return K(()=>{const{id:s}=e.query;s&&z(s).then(r=>{const{personnel:_}=r;i.value=L(S({},r),{personnel:me.map(u=>{const c=_.filter(({type:f})=>f.includes(u.value));return L(S({},u),{children:c})}).filter(({children:u})=>!!u.length),personnelList:_}),l.value=!0})}),{form:i,over:l}}},ao={class:"project-jc"};function so(d,l,i,e,z,T){const s=a("Left"),r=a("el-col"),_=a("Right"),u=a("el-row");return v(),U("div",ao,[e.over?(v(),A(u,{key:0,gutter:20},{default:n(()=>[o(r,{span:5},{default:n(()=>[o(s,{form:e.form},null,8,["form"])]),_:1}),o(r,{span:19},{default:n(()=>[o(_,{db:e.form},null,8,["db"])]),_:1})]),_:1})):oe("",!0)])}var fo=Z(to,[["render",so]]);export{fo as default};
